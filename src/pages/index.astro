---
import { Image } from "astro:assets";
import { getCollection } from "astro:content";
import BaseHead from "../components/BaseHead.astro";
import Footer from "../components/Footer.astro";
import FormattedDate from "../components/FormattedDate.astro";
import Header from "../components/Header.astro";
import { SITE_DESCRIPTION, SITE_TITLE } from "../consts";
import "../styles/global.css";

const posts = (await getCollection("blog")).sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
);
---

<!doctype html>
<html lang="en">
  <head>
    <BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
    <style>
      :root {
        color-scheme: light dark;
        --bg: whitesmoke;
        --fg: black;
        --muted: color-mix(in oklab, var(--fg), transparent 45%);
        --card: white;
        --ring: color-mix(in oklab, var(--fg), transparent 80%);
        --accent: dodgerblue;
      }

      @media (prefers-color-scheme: dark) {
        :root {
          --bg: #1a1a1a;
          --fg: whitesmoke;
          --muted: color-mix(in oklab, var(--fg), transparent 40%);
          --card: #2a2a2a;
          --ring: color-mix(in oklab, var(--fg), transparent 70%);
          --accent: deepskyblue;
        }
      }

      body {
        margin: 0;
        background: var(--bg);
        color: var(--fg);
      }

      main {
        max-width: 72rem;
        margin: 0 auto;
        padding: 2rem 1.25rem 3rem;
      }

      ul {
        list-style: none;
        padding: 0;
        margin: 0;
        display: grid;
        gap: 1.25rem;
      }

      li a {
        display: grid;
        gap: 0.5rem;
        padding: 1rem;
        border: 1px solid var(--ring);
        border-radius: 0.75rem;
        background: var(--card);
        text-decoration: none;
        color: inherit;
        transition:
          transform 120ms ease,
          border-color 120ms ease;
      }

      li a:hover {
        transform: translateY(-2px);
        border-color: color-mix(in oklab, var(--accent), var(--ring) 60%);
      }

      img {
        width: 100%;
        height: auto;
        border-radius: 0.5rem;
      }

      .title {
        margin: 0.25rem 0 0;
        font-size: 1.1rem;
      }

      .date {
        margin: 0;
        color: var(--muted);
        font-size: 0.9rem;
      }

      @media (min-width: 48rem) {
        ul {
          grid-template-columns: repeat(2, minmax(0, 1fr));
        }
      }
    </style>
  </head>
  <body>
    <Header />
    <main>
      <section>
        <ul>
          {
            posts.map((post) => (
              <li>
                <a href={`/blog/${post.id}/`}>
                  {post.data.heroImage && (
                    <Image
                      width={720}
                      height={360}
                      src={post.data.heroImage}
                      alt=""
                    />
                  )}
                  <h4 class="title">{post.data.title}</h4>
                  <p class="date">
                    <FormattedDate date={post.data.pubDate} />
                  </p>
                </a>
              </li>
            ))
          }
        </ul>
      </section>
    </main>
    <Footer />
  </body>
</html>
